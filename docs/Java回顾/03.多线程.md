# Javaå¤šçº¿ç¨‹ç¼–ç¨‹è¯¦è§£

å¤šçº¿ç¨‹ç¼–ç¨‹æ˜¯Javaä¸­ä¸€ä¸ªé‡è¦çš„ä¸»é¢˜ï¼Œå…è®¸ç¨‹åºåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œæç¨‹åºçš„æ•ˆç‡å’Œæ€§èƒ½ã€‚

## å®šä¹‰

- **ç¨‹åº(program)**æ˜¯ä¸ºå®Œæˆç‰¹å®šä»»åŠ¡ã€ç”¨æŸç§è¯­è¨€ç¼–å†™çš„ä¸€ç»„æŒ‡ä»¤çš„é›†åˆã€‚å³æŒ‡ä¸€ æ®µé™æ€çš„ä»£ç ï¼Œé™æ€å¯¹è±¡ã€‚
- **è¿›ç¨‹(process)**æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ–æ˜¯æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªç¨‹åºã€‚æ˜¯ä¸€ä¸ªåŠ¨æ€ çš„è¿‡ç¨‹ï¼šæœ‰å®ƒè‡ªèº«çš„äº§ç”Ÿã€å­˜åœ¨å’Œæ¶ˆäº¡çš„è¿‡ç¨‹ã€‚â€”â€”ç”Ÿå‘½å‘¨æœŸ
- **çº¿ç¨‹(thread)**ï¼Œè¿›ç¨‹å¯è¿›ä¸€æ­¥ç»†åŒ–ä¸ºçº¿ç¨‹ï¼Œæ˜¯ä¸€ä¸ªç¨‹åºå†…éƒ¨çš„ä¸€æ¡æ‰§è¡Œè·¯å¾„ã€‚
- - > [!Note] è‹¥ä¸€ä¸ªè¿›ç¨‹åŒä¸€æ—¶é—´å¹¶è¡Œæ‰§è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œå°±æ˜¯æ”¯æŒå¤šçº¿ç¨‹çš„
- - çº¿ç¨‹ä½œä¸ºè°ƒåº¦å’Œæ‰§è¡Œçš„å•ä½ï¼Œæ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„è¿è¡Œæ ˆå’Œç¨‹åºè®¡æ•°å™¨(pc)ï¼Œçº¿ç¨‹åˆ‡æ¢çš„å¼€é”€å°ã€‚
- - ä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹å…±äº«ç›¸åŒçš„å†…å­˜å•å…ƒ/å†…å­˜åœ°å€ç©ºğŸ‘‰å®ƒä»¬ä»åŒä¸€å †ä¸­åˆ†é…å¯¹è±¡ï¼Œå¯ä»¥è®¿é—®ç›¸åŒçš„å˜é‡å’Œå¯¹è±¡ã€‚è¿™å°±ä½¿å¾—çº¿ç¨‹é—´é€šä¿¡æ›´ç®€ä¾¿ã€é«˜æ•ˆã€‚ä½†å¤šä¸ªçº¿ç¨‹æ“ä½œå…±äº«çš„ç³»ç»Ÿèµ„ æºå¯èƒ½å°±ä¼šå¸¦æ¥å®‰å…¨çš„éšæ‚£

## å•æ ¸ä¸å¤šæ ¸CPU

> å•æ ¸CPUï¼Œå…¶å®æ˜¯ä¸€ç§å‡çš„å¤šçº¿ç¨‹ï¼Œå› ä¸ºåœ¨ä¸€ä¸ªæ—¶é—´å•å…ƒå†…ï¼Œä¹Ÿåªèƒ½æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹ çš„ä»»åŠ¡ã€‚

> ä¸€ä¸ªJavaåº”ç”¨ç¨‹åºjava.exeï¼Œå…¶å®è‡³å°‘æœ‰ä¸‰ä¸ªçº¿ç¨‹ï¼šmain()ä¸»çº¿ç¨‹ï¼Œgc() åƒåœ¾å›æ”¶çº¿ç¨‹ï¼Œå¼‚å¸¸å¤„ç†çº¿ç¨‹ã€‚å½“ç„¶å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œä¼šå½±å“ä¸»çº¿ç¨‹ã€‚

## å¹¶è¡Œä¸å¹¶å‘

> å¹¶è¡Œï¼šå¤šä¸ªCPUåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚æ¯”å¦‚ï¼šå¤šä¸ªäººåŒæ—¶åšä¸åŒçš„äº‹ã€‚ 


> å¹¶å‘ï¼šä¸€ä¸ªCPU(é‡‡ç”¨æ—¶é—´ç‰‡)åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚æ¯”å¦‚ï¼šç§’æ€ã€å¤šä¸ªäººåšåŒä¸€ä»¶äº‹ã€‚

## çº¿ç¨‹åˆ›å»ºå¯åŠ¨åŸç†

Javaä¸­çš„å¤šçº¿ç¨‹æ˜¯é€šè¿‡åˆ›å»ºå’Œç®¡ç†çº¿ç¨‹å¯¹è±¡æ¥å®ç°çš„ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯ç¨‹åºä¸­ç‹¬ç«‹æ‰§è¡Œçš„è·¯å¾„ï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œä¸åŒçš„ä»£ç ç‰‡æ®µã€‚Javaæä¾›äº†`Thread`ç±»å’Œ`Runnable`æ¥å£æ¥æ”¯æŒå¤šçº¿ç¨‹ç¼–ç¨‹ã€‚

### Threadç±»

`Thread`ç±»æ˜¯Javaä¸­è¡¨ç¤ºçº¿ç¨‹çš„ç±»ï¼Œå®ƒåŒ…å«äº†åˆ›å»ºã€å¯åŠ¨ã€æš‚åœã€ç»ˆæ­¢çº¿ç¨‹ç­‰æ–¹æ³•ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡ç»§æ‰¿`Thread`ç±»å¹¶é‡å†™å…¶`run()`æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹ã€‚

```java
class MyThread01 extends Thread {
Â  Â  @Override
Â  Â  public void run() {
Â  Â  Â  Â  System.out.println("-----MyThread01");
Â  Â  }
}
```

### Runnableæ¥å£

`Runnable`æ¥å£å®šä¹‰äº†ä¸€ä¸ªçº¿ç¨‹çš„ä»»åŠ¡ï¼Œå®ƒåªåŒ…å«ä¸€ä¸ª`run()`æ–¹æ³•ï¼Œç”¨äºå®šä¹‰çº¿ç¨‹æ‰§è¡Œçš„ä»£ç ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡å®ç°`Runnable`æ¥å£å¹¶ä¼ é€’ç»™`Thread`ç±»çš„æ„é€ å‡½æ•°æ¥åˆ›å»ºçº¿ç¨‹ã€‚

```java
class MyThread02 implements Runnable {
Â  Â  public void run() {
Â  Â  Â  Â  System.out.println("-----MyThread02");
Â  Â  }
}
```

## å¸¸è§ç”¨æ³•

### åˆ›å»ºçº¿ç¨‹

å¯ä»¥é€šè¿‡ç»§æ‰¿`Thread`ç±»æˆ–å®ç°`Runnable`æ¥å£æ¥åˆ›å»ºçº¿ç¨‹å¯¹è±¡ã€‚

```java
import java.util.concurrent.Callable;
import java.util.concurrent.ExecutionException;
import java.util.concurrent.FutureTask;
/*åˆ›å»ºå¤šçº¿ç¨‹çš„æ–¹å¼
1.ç»§æ‰¿Thread
2.å®ç°Runnable
3.å®ç°Callable
4.ä½¿ç”¨çº¿ç¨‹æ± 
*/
class MyThread01 extends Thread {
Â  Â  @Override
Â  Â  public void run() {
Â  Â  Â  Â  System.out.println("-----MyThread01");
Â  Â  }
}

class MyThread02 implements Runnable {
Â  Â  public void run() {
Â  Â  Â  Â  System.out.println("-----MyThread02");
Â  Â  }
}

class MyThread03 implements Callable<Integer> {
Â  Â  @Override
Â  Â  public Integer call() throws Exception {
Â  Â  Â  Â  System.out.println("-----MyThread03");
Â  Â  Â  Â  return 200;
Â  Â  }
}

public class ThreadNew {
Â  Â  public static void main(String[] args) {
Â  Â  Â  Â  new MyThread01().start();
Â  Â  Â  Â  new Thread(new MyThread02()).start();
Â  Â  Â  Â  FutureTask<Integer> futureTask = new FutureTask<Integer>(new MyThread03());
Â  Â  Â  Â  new Thread(futureTask).start();
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Integer value = futureTask.get();
Â  Â  Â  Â  Â  Â  System.out.println(value);
Â  Â  Â  Â  } catch (InterruptedException e) {
Â  Â  Â  Â  Â  Â  e.printStackTrace();
Â  Â  Â  Â  } catch (ExecutionException e) {
Â  Â  Â  Â  Â  Â  e.printStackTrace();
Â  Â  Â  Â  }
Â  Â  }
}
```

### çº¿ç¨‹åŒæ­¥

  
çº¿ç¨‹åŒæ­¥æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹ä¹‹é—´å¯¹å…±äº«èµ„æºçš„è®¿é—®é¡ºåºè¿›è¡Œåè°ƒï¼Œä»¥é¿å…å‡ºç°æ•°æ®ä¸ä¸€è‡´æˆ–è€…å†²çªçš„æƒ…å†µã€‚åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´æˆ–è€…å‡ºç°ç«æ€æ¡ä»¶çš„é—®é¢˜ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨çº¿ç¨‹åŒæ­¥æ¥ä¿è¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„åè°ƒå’Œé¡ºåºæ‰§è¡Œã€‚

Javaæä¾›äº†`synchronized`å…³é”®å­—å’Œ`Lock`æ¥å£æ¥å®ç°çº¿ç¨‹åŒæ­¥ã€‚

#### synchronizedå…³é”®å­—

`synchronized`å…³é”®å­—å¯ä»¥åº”ç”¨äºæ–¹æ³•æˆ–è€…ä»£ç å—ï¼Œå®ƒå¯ä»¥ä¿è¯åœ¨åŒä¸€æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œè¢«`synchronized`ä¿®é¥°çš„ä»£ç ï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…è¯¥çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åæ‰èƒ½æ‰§è¡Œã€‚

```java
class Counter {
    private int count = 0;

    public synchronized void increment() {
        count++;
    }
}
```
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`increment()`æ–¹æ³•è¢«`synchronized`ä¿®é¥°ï¼Œä¿è¯äº†å¤šä¸ªçº¿ç¨‹è°ƒç”¨è¯¥æ–¹æ³•æ—¶ä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

#### Lockæ¥å£

`Lock`æ¥å£æä¾›äº†æ›´åŠ çµæ´»å’Œç²¾ç»†åŒ–çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼Œå®ƒå…è®¸ç¨‹åºå‘˜æ‰‹åŠ¨æ§åˆ¶é”çš„è·å–å’Œé‡Šæ”¾ã€‚

```java
import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantLock;

class Counter {
    private int count = 0;
    private Lock lock = new ReentrantLock();

    public void increment() {
        lock.lock();
        try {
            count++;
        } finally {
            lock.unlock();
        }
    }
}

```
ä½¿ç”¨äº†`ReentrantLock`å®ç°äº†é”çš„åŒæ­¥ï¼Œ`lock()`æ–¹æ³•ç”¨äºè·å–é”ï¼Œ`unlock()`æ–¹æ³•ç”¨äºé‡Šæ”¾é”ã€‚

### çº¿ç¨‹é€šä¿¡

å¤šä¸ªçº¿ç¨‹ä¹‹é—´éœ€è¦è¿›è¡Œé€šä¿¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`wait()`ã€`notify()`å’Œ`notifyAll()`æ–¹æ³•æ¥å®ç°çº¿ç¨‹é—´çš„åä½œã€‚

```java
class Message {
    private String content;
    private boolean available = false;
    public synchronized String read() {
        while (!available) {
            try {
                wait();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        available = false;
        notifyAll();
        return content;
    }
    public synchronized void write(String content) {
        while (available) {
            try {
                wait();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        this.content = content;
        available = true;
        notifyAll();
    }
}
```

## æ³¨æ„äº‹é¡¹

åœ¨è¿›è¡Œå¤šçº¿ç¨‹ç¼–ç¨‹æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹äº‹é¡¹ï¼š

- **çº¿ç¨‹å®‰å…¨æ€§ï¼š** å¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºæ—¶éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨é”æ¥å®ç°çº¿ç¨‹åŒæ­¥ã€‚
- **é¿å…æ­»é”ï¼š** å½“å¤šä¸ªçº¿ç¨‹ç›¸äº’ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºæ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ­»é”é—®é¢˜ï¼Œéœ€è¦è°¨æ…è®¾è®¡çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºã€‚
- **èµ„æºç®¡ç†ï¼š** åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­è¦æ³¨æ„åŠæ—¶é‡Šæ”¾èµ„æºï¼Œé¿å…å†…å­˜æ³„æ¼å’Œèµ„æºç«äº‰é—®é¢˜ã€‚
- **çº¿ç¨‹æ± ï¼š** ä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥æé«˜çº¿ç¨‹çš„ç®¡ç†å’Œæ•ˆç‡ï¼Œé¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ã€‚
