# 09. 数据增删改

## 1. 插入数据
![](assets/09.%20数据增删改_image_1.png)

```sql
INSERT INTO 表名 VALUES (value1,value2,....);

INSERT INTO departments VALUES (70, 'Pub', 100, 1700);
INSERT INTO departments VALUES (100, 'Finance', NULL, NULL);

# 为表的指定字段插入数据
INSERT INTO 表名(column1 [, column2, …, columnn]) VALUES (value1 [,value2, …, valuen]);
INSERT INTO departments(department_id, department_name) VALUES (80, 'IT');

# 同时插入多条记录
INSERT INTO table_name VALUES 
(value1 [,value2, …, valuen]), 
(value1 [,value2, …, valuen]), …… 
(value1 [,value2, …, valuen]);

INSERT INTO table_name
(column1 [, column2, …, columnn]) 
VALUES 
(value1 [,value2, …, valuen]), 
(value1 [,value2, …, valuen]), …… 
(value1 [,value2, …, valuen]);

INSERT INTO emp(emp_id,emp_name)
VALUES 
(1001,'shkstart'),
(1002,'atguigu'),
(1003,'Tom');

# 将查询结果插入到表中
INSERT INTO 目标表名 
(tar_column1 [, tar_column2, …, tar_columnn]) 
SELECT 
(src_column1 [, src_column2, …, src_columnn]) 
FROM 源表名 
[WHERE condition]
```

> [!NOTE]
> 一个同时插入多行记录的INSERT语句等同于多个单行插入的INSERT语句，但是多行的INSERT语句 在处理过程中 效率更高 。因为MySQL执行单条INSERT语句插入多行数据比使用多条INSERT语句 快，所以在插入多条记录时最好选择使用单条INSERT语句的方式插入。

- 在 INSERT 语句中加入子查询。 
- 不必书写 VALUES 子句。 
- 子查询中的值列表应与 INSERT 子句中的列名对应。

```sql
INSERT INTO emp2 
SELECT * FROM employees WHERE department_id = 90;

INSERT INTO sales_reps(id, name, salary, commission_pct) SELECT employee_id, last_name, salary, commission_pct 
FROM employees WHERE job_id LIKE '%REP%';
```

## 2. 更新数据
![](assets/09.%20数据增删改_image_2.png)

```sql
UPDATE table_name 
SET column1=value1, column2=value2, … , column=valuen [WHERE condition]
```

- 可以一次更新多条数据。 
- 如果需要回滚数据，需要保证在DML前，进行设置：SET AUTOCOMMIT = FALSE;

```sql
使用 WHERE 子句指定需要更新的数据。
UPDATE employees 
SET department_id = 70 
WHERE employee_id = 113;

如果省略 WHERE 子句，则表中的所有数据都将被更新。
UPDATE copy_emp 
SET department_id = 110;

更新中的数据完整性错误
UPDATE employees 
SET department_id = 55 
WHERE department_id = 110;
```

## 3. 删除数据
![](assets/09.%20数据增删改_image_3.png)

- 使用 DELETE 语句从表中删除数据
```sql
table_name指定要执行删除操作的表；“[WHERE ]”为可选参数，指定删除条件，如果没有WHERE子句， DELETE语句将删除表中的所有记录。

使用 WHERE 子句删除指定的记录。
DELETE FROM departments WHERE department_name = 'Finance';

如果省略 WHERE 子句，则表中的全部数据将被删除
DELETE FROM copy_emp;

删除中的数据完整性错误
DELETE FROM departments WHERE department_id = 60;
```

## 4. MySQL8新特性：计算列

某一列的值是通过别的列计算得来的。

```sql
CREATE TABLE tb1( 
id INT, 
a INT, 
b INT, 
c INT GENERATED ALWAYS AS (a + b) VIRTUAL );
```

## 练习